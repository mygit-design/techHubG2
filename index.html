<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meal Attendance Tracker</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
       @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Montserrat:wght@400;500;600;700&display=swap');

:root {
    /* Modern color palette */
    --primary: #5e60ce;
    --primary-light: #6930c3;
    --secondary: #5390d9;
    --secondary-light: #7400b8;
    --accent: #48bfe3;
    --success: #06d6a0;
    --warning: #ffbe0b;
    --danger: #ef476f;
    --light: #f8f9fa;
    --dark: #212529;
    --gray: #6c757d;
    --gray-light: #e9ecef;
    --white: #ffffff;
    --shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
    --smooth: all 0.3s ease;
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Poppins', sans-serif;
}

body {
    color: var(--dark);
    line-height: 1.6;
    min-height: 100vh;
    padding-bottom: 40px;
    position: relative;
    overflow-x: hidden;
}

/* Rotating background images */
.bg-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -1;
    overflow: hidden;
}

.bg-image {
    position: absolute;
    width: 100%;
    height: 100%;
    opacity: 0;
    transition: opacity 1s ease-in-out;
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
}

.bg-image.active {
    opacity: 0.05;
}

/* Content overlay */
.content-overlay {
    position: relative;
    z-index: 1;
    background: linear-gradient(135deg, rgba(246, 248, 253, 0.9), rgba(237, 242, 251, 0.9));
    min-height: 100vh;
}

h1, h2, h3, h4 {
    font-family: 'Montserrat', sans-serif;
    font-weight: 600;
    letter-spacing: -0.02em;
}

.container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

/* Header styling with logo */
.header {
    background: linear-gradient(135deg, var(--primary), var(--secondary-light));
    color: white;
    padding: 25px;
    border-radius: 12px;
    margin-bottom: 30px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: var(--shadow);
    position: relative;
    overflow: hidden;
}

.header::before {
    content: "";
    position: absolute;
    top: -50px;
    right: -50px;
    width: 200px;
    height: 200px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.1);
    z-index: 0;
}

.header-left {
    display: flex;
    align-items: center;
    gap: 20px;
    position: relative;
    z-index: 1;
}

.company-logo {
    width: 60px; 
    height: 60px;
    background-color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
}

.company-logo img {
    max-width: 50px;
    max-height: 50px;
    object-fit: contain;
}

.header-title {
    position: relative;
    z-index: 1;
}

.header-title h1 {
    font-size: 28px;
    font-weight: 700;
    margin-bottom: 5px;
}

.header-title p {
    opacity: 0.9;
    font-size: 15px;
    font-weight: 300;
}

.header .date-time {
    font-size: 15px;
    text-align: right;
    position: relative;
    z-index: 1;
}

#current-time {
    font-size: 18px;
    font-weight: 600;
    margin-bottom: 3px;
}

/* Tab navigation */
.tabs {
    display: flex;
    background: var(--white);
    border-radius: 12px;
    overflow: hidden;
    margin-bottom: 30px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
}

.tab-btn {
    flex: 1;
    padding: 16px;
    border: none;
    background: var(--white);
    cursor: pointer;
    font-size: 16px;
    font-weight: 500;
    color: var(--gray);
    transition: var(--smooth);
    position: relative;
}

.tab-btn::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 0;
    height: 3px;
    background: var(--primary);
    transition: var(--smooth);
}

.tab-btn:hover {
    color: var(--primary);
}

.tab-btn:hover::after {
    width: 30%;
}

.tab-btn.active {
    color: var(--primary);
    background-color: rgba(94, 96, 206, 0.05);
}

.tab-btn.active::after {
    width: 80%;
}

.tab-content {
    display: none;
    background: var(--white);
    padding: 30px;
    border-radius: 12px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
    margin-bottom: 30px;
    animation: fadeIn 0.5s;
}

.tab-content h2 {
    color: var(--primary);
    margin-bottom: 10px;
    font-size: 24px;
}

.tab-content p {
    color: var(--gray);
    margin-bottom: 20px;
    font-size: 15px;
}

.tab-content.active {
    display: block;
}

/* Form elements */
.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 500;
    color: var(--dark);
    font-size: 15px;
}

.form-control {
    width: 100%;
    padding: 14px;
    border: 1px solid #ddd;
    border-radius: 8px;
    font-size: 16px;
    transition: var(--smooth);
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05) inset;
}

.form-control:focus {
    border-color: var(--primary);
    outline: none;
    box-shadow: 0 0 0 3px rgba(94, 96, 206, 0.2);
}

/* Buttons */
.btn {
    padding: 12px 24px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 16px;
    font-weight: 500;
    transition: var(--smooth);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
}

.btn-primary {
    background: linear-gradient(135deg, var(--primary), var(--primary-light));
    color: white;
    box-shadow: 0 4px 12px rgba(94, 96, 206, 0.3);
}

.btn-primary:hover {
    background: linear-gradient(135deg, var(--primary-light), var(--secondary-light));
    transform: translateY(-2px);
    box-shadow: 0 6px 15px rgba(94, 96, 206, 0.4);
}

.btn-danger {
    background: linear-gradient(135deg, var(--danger), #e62e5c);
    color: white;
    box-shadow: 0 4px 12px rgba(239, 71, 111, 0.3);
}

.btn-danger:hover {
    background: linear-gradient(135deg, #e62e5c, #d01c49);
    transform: translateY(-2px);
    box-shadow: 0 6px 15px rgba(239, 71, 111, 0.4);
}

.btn-success {
    background: linear-gradient(135deg, var(--success), #05b286);
    color: white;
    box-shadow: 0 4px 12px rgba(6, 214, 160, 0.3);
}

.btn-success:hover {
    background: linear-gradient(135deg, #05b286, #05a079);
    transform: translateY(-2px);
    box-shadow: 0 6px 15px rgba(6, 214, 160, 0.4);
}

/* Fingerprint scanner */
.fingerprint-container {
    text-align: center;
    margin: 40px 0;
    padding: 30px;
    background: linear-gradient(135deg, #f8f9fa, #f1f3f5);
    border-radius: 12px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
}

.fingerprint-icon {
    font-size: 90px;
    color: var(--gray);
    margin-bottom: 20px;
    transition: var(--smooth);
}

.fingerprint-icon.scanning {
    color: var(--primary);
    animation: pulse 1.5s infinite;
}

.fingerprint-icon.success {
    color: var(--success);
}

.fingerprint-icon.error {
    color: var(--danger);
}

.fingerprint-container p {
    color: var(--gray);
    margin-bottom: 20px;
    font-size: 16px;
}

/* Status messages */
.status-message {
    padding: 18px;
    border-radius: 8px;
    margin: 20px 0;
    font-weight: 500;
    text-align: center;
    display: none;
    font-size: 15px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
}

.status-message.success {
    background-color: rgba(6, 214, 160, 0.1);
    color: var(--success);
    border: 1px solid rgba(6, 214, 160, 0.3);
    display: block;
}

.status-message.error {
    background-color: rgba(239, 71, 111, 0.1);
    color: var(--danger);
    border: 1px solid rgba(239, 71, 111, 0.3);
    display: block;
}

/* Dashboard statistics */
.dashboard-stats {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    margin-bottom: 30px;
}

.stat-card {
    flex: 1;
    min-width: 200px;
    padding: 25px;
    background: var(--white);
    border-radius: 12px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
    text-align: center;
    transition: var(--smooth);
    position: relative;
    overflow: hidden;
}

.stat-card::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 4px;
    background: linear-gradient(90deg, var(--primary), var(--accent));
}

.stat-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
}

.stat-card h3 {
    color: var(--gray);
    font-size: 16px;
    margin-bottom: 15px;
}

.stat-card .stat-value {
    font-size: 38px;
    font-weight: 700;
    color: var(--primary);
    margin-bottom: 5px;
}

.stat-card .last-scan {
    margin-top: 15px;
    font-size: 14px;
    color: var(--gray);
}

/* Admin dashboard */
.admin-controls {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    margin-bottom: 30px;
}

.date-filter {
    display: flex;
    gap: 15px;
    align-items: center;
    flex-wrap: wrap;
    padding: 20px;
    background: rgba(94, 96, 206, 0.05);
    border-radius: 12px;
    margin-bottom: 20px;
}

/* Tables */
table {
    width: 100%;
    border-collapse: collapse;
    margin: 25px 0;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
}

table th, table td {
    padding: 15px;
    text-align: left;
    border-bottom: 1px solid #eaeaea;
}

table th {
    background-color: rgba(94, 96, 206, 0.08);
    font-weight: 600;
    color: var(--primary);
    position: sticky;
    top: 0;
}

table tr:hover {
    background-color: rgba(94, 96, 206, 0.03);
}

.staff-list {
    margin-top: 30px;
}

/* Animations */
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

@keyframes pulse {
    0% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.1); opacity: 0.7; }
    100% { transform: scale(1); opacity: 1; }
}

@keyframes float {
    0% { transform: translateY(0px) rotate(0deg); }
    50% { transform: translateY(-15px) rotate(5deg); }
    100% { transform: translateY(0px) rotate(0deg); }
}

/* Responsive styles */
@media (max-width: 992px) {
    .container {
        padding: 15px;
    }
    
    .header {
        padding: 20px;
    }
    
    .header-title h1 {
        font-size: 22px;
    }
    
    .company-logo {
        width: 50px;
        height: 50px;
    }
    
    .company-logo img {
        max-width: 40px;
        max-height: 40px;
    }
}

@media (max-width: 768px) {
    .tabs {
        flex-direction: column;
        margin-bottom: 20px;
    }
    
    .tab-btn {
        padding: 12px;
        text-align: center;
    }
    
    .tab-btn::after {
        bottom: auto;
        top: 0;
        height: 3px;
        width: 0;
    }
    
    .tab-btn.active::after {
        width: 40%;
    }
    
    .tab-content {
        padding: 20px;
    }
    
    .dashboard-stats {
        flex-direction: column;
        gap: 15px;
    }
    
    .date-filter {
        flex-direction: column;
        align-items: stretch;
    }
    
    .header {
        flex-direction: column;
        text-align: center;
    }
    
    .header-left {
        justify-content: center;
        margin-bottom: 15px;
    }
    
    .header .date-time {
        text-align: center;
    }
    
    .fingerprint-container {
        padding: 20px;
    }
    
    .fingerprint-icon {
        font-size: 70px;
    }
    
    .btn {
        width: 100%;
        margin-bottom: 10px;
    }
    
    .admin-controls .btn {
        flex: 1 0 100%;
    }
}

@media (max-width: 480px) {
    .header-title h1 {
        font-size: 20px;
    }
    
    .company-logo {
        width: 40px;
        height: 40px;
    }
    
    .company-logo img {
        max-width: 30px;
        max-height: 30px;
    }
    
    .tab-content h2 {
        font-size: 20px;
    }
    
    .fingerprint-icon {
        font-size: 60px;
    }
    
    .stat-card .stat-value {
        font-size: 32px;
    }
    
    table th, table td {
        padding: 12px 8px;
        font-size: 14px;
    }
    
    /* Make tables scrollable horizontally on mobile */
    .attendance-report, .staff-list {
        overflow-x: auto;
    }
}

/* Global Styles */
body {
            animation: backgroundRotation 30s infinite linear;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            background-size: cover;
            background-position: center;
            transition: background-image 1s ease-in-out;
        }
        
        @keyframes backgroundRotation {
            0% { background-image: url('anton-murygin-jD7WYFNJ-0s-unsplash.jpg'); }
            33% { background-image: url('arturo-rey-CgVqj1l-u44-unsplash.jpg'); }
            66% { background-image: url('aubrey-odom-bzbWIxsN3iQ-unsplash.jpg'); }
            100% { background-image: url('anton-murygin-jD7WYFNJ-0s-unsplash.jpg'); }
        }


    </style>
</head>
<body>


    <div class="content-overlay">
        <div class="container">
            <div class="header">
                <div class="header-left">
                    <div class="company-logo">
                        <!-- Replace with your company logo -->
                        <img src="uac.png" alt="Company Logo">
                    </div>
                    <div class="header-title">
                        <h1>UAC Foods LTD Meal Attendance Tracker</h1>
                        <p>Track staff meal collections efficiently</p>
                    </div>
                </div>
                <div class="date-time">
                    <div id="current-time">10:30 AM</div>
                    <div id="current-date">April 8, 2025</div>
                </div>
            </div>
            
            <div class="tabs">
                <button class="tab-btn active" data-tab="registration">Registration</button>
                <button class="tab-btn" data-tab="dashboard">Dashboard</button>
                <button class="tab-btn" data-tab="admin">Admin</button>
            </div>
            
            <!-- Registration Tab -->
            <div class="tab-content active" id="registration">
                <h2>Staff Registration</h2>
                <p>Register new staff members with their fingerprint</p>
                
                <form id="registration-form">
                    <div class="form-group">
                        <label for="staff-name">Full Name</label>
                        <input type="text" id="staff-name" class="form-control" placeholder="Enter staff name" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="staff-id">Staff ID</label>
                        <input type="text" id="staff-id" class="form-control" placeholder="Enter staff ID" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="department">Department</label>
                        <input type="text" id="department" class="form-control" placeholder="Enter department" required>
                    </div>
                    
                    <div class="fingerprint-container">
                        <div class="fingerprint-icon">
                            <i class="fas fa-fingerprint"></i>
                        </div>
                        <p>Click the button below to scan fingerprint</p>
                        <button type="button" id="scan-thumb" class="btn btn-primary" style="margin-top: 10px;">Scan Thumb</button>
                        <button type="button" id="scan-finger" class="btn btn-primary" style="margin-top: 10px; margin-left: 10px;">Scan Finger</button>
                    </div>
                    
                    <div id="registration-status" class="status-message"></div>
                    
                    <button type="submit" class="btn btn-primary">Register Staff</button>
                </form>
            </div>
            
            <!-- Dashboard Tab -->
            <div class="tab-content" id="dashboard">
                <h2>Meal Collection Dashboard</h2>
                <p>Staff can scan their fingerprint to register for a meal</p>
                
                <div class="dashboard-stats">
                    <div class="stat-card">
                        <h3>Today's Meal Count</h3>
                        <div class="stat-value" id="meal-count">0</div>
                    </div>
                    
                    <div class="stat-card">
                        <h3>Last Collection</h3>
                        <div class="stat-value" id="last-scan">-</div>
                        <div class="last-scan" id="last-scan-time">-</div>
                    </div>
                    
                    <div class="stat-card">
                        <h3>Weekly Total</h3>
                        <div class="stat-value" id="weekly-count">0</div>
                    </div>
                </div>
                
                <div class="fingerprint-container">
                    <div class="fingerprint-icon" id="scan-icon">
                        <i class="fas fa-fingerprint"></i>
                    </div>
                    <p>Place your finger on the scanner to register for a meal</p>
                    <button type="button" id="scan-meal" class="btn btn-primary" style="margin-top: 10px;">Scan Fingerprint</button>
                </div>
                
                <div id="scan-status" class="status-message"></div>
            </div>
            
            <!-- Admin Tab -->
            <div class="tab-content" id="admin">
                <div id="admin-login">
                    <h2>Admin Login</h2>
                    <form id="admin-login-form">
                        <div class="form-group">
                            <label for="username">Username</label>
                            <input type="text" id="username" class="form-control" placeholder="Enter username" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="password">Password</label>
                            <input type="password" id="password" class="form-control" placeholder="Enter password" required>
                        </div>
                        
                        <div id="login-status" class="status-message"></div>
                        
                        <button type="submit" class="btn btn-primary">Login</button>
                    </form>
                </div>
                
                <div id="admin-dashboard" style="display: none;">
                    <h2>Admin Dashboard</h2>
                    
                    <div class="admin-controls">
                        <button id="reset-count" class="btn btn-danger">Reset Today's Count</button>
                        <button id="logout-btn" class="btn btn-primary">Logout</button>
                    </div>
                    
                    <h3>Attendance Reports</h3>
                    
                    <div class="date-filter">
                        <div class="form-group">
                            <label for="start-date">Start Date</label>
                            <input type="date" id="start-date" class="form-control">
                        </div>
                        
                        <div class="form-group">
                            <label for="end-date">End Date</label>
                            <input type="date" id="end-date" class="form-control">
                        </div>
                        
                        <button id="filter-btn" class="btn btn-primary">Filter</button>
                        <button id="export-btn" class="btn btn-success">Export to CSV</button>
                    </div>
                    
                    <div class="attendance-report">
                        <table id="attendance-table">
                            <thead>
                                <tr>
                                    <th>Staff ID</th>
                                    <th>Name</th>
                                    <th>Department</th>
                                    <th>Date</th>
                                    <th>Time</th>
                                </tr>
                            </thead>
                            <tbody id="attendance-data">
                                <!-- Attendance data will be inserted here -->
                            </tbody>
                        </table>
                    </div>

                    <h3>Meal Count Trends</h3>
                    <div class="chart-container">
                            <div id="meal-chart-container" style="min-height: 400px; margin-bottom: 30px;"></div>
                    </div>
                    
                    <h3>Registered Staff</h3>
                    <div class="staff-list">
                        <table id="staff-table">
                            <thead>
                                <tr>
                                    <th>Staff ID</th>
                                    <th>Name</th>
                                    <th>Department</th>
                                    <th>Registration Date</th>
                                </tr>
                            </thead>
                            <tbody id="staff-data">
                                <!-- Staff data will be inserted here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Database simulation
        const DB = {
            init: function() {
                if (!localStorage.getItem('staffRecords')) {
                    localStorage.setItem('staffRecords', JSON.stringify([]));
                }
                if (!localStorage.getItem('attendanceLogs')) {
                    localStorage.setItem('attendanceLogs', JSON.stringify([]));
                }
                if (!localStorage.getItem('statistics')) {
                    const today = new Date().toISOString().split('T')[0];
                    localStorage.setItem('statistics', JSON.stringify({
                        dailyCount: 0,
                        weeklyCount: 0,
                        monthlyCount: 0,
                        lastScan: null,
                        lastCountReset: today
                    }));
                }
            },
            getStaff: function(staffId = null) {
                const staff = JSON.parse(localStorage.getItem('staffRecords')) || [];
                if (staffId) {
                    return staff.find(s => s.staffId === staffId) || null;
                }
                return staff;
            },
            addStaff: function(staffData) {
                const staff = this.getStaff();
                const exists = staff.some(s => s.staffId === staffData.staffId);
                
                if (exists) {
                    return { success: false, message: 'Staff ID already registered' };
                }
                
                staffData.registrationDate = new Date().toISOString();
                staff.push(staffData);
                localStorage.setItem('staffRecords', JSON.stringify(staff));
                return { success: true };
            },
            getAttendance: function(startDate = null, endDate = null) {
                let logs = JSON.parse(localStorage.getItem('attendanceLogs')) || [];
                
                if (startDate && endDate) {
                    logs = logs.filter(log => {
                        const logDate = new Date(log.timestamp).toISOString().split('T')[0];
                        return logDate >= startDate && logDate <= endDate;
                    });
                }
                
                return logs;
            },
            addAttendance: function(staffId) {
                const staff = this.getStaff(staffId);
                if (!staff) {
                    return { success: false, message: 'Staff not registered' };
                }
                
                const today = new Date().toISOString().split('T')[0];
                const logs = this.getAttendance();
                
                // Check if staff already collected a meal today
                const alreadyCollected = logs.some(log => {
                    return log.staffId === staffId && 
                           new Date(log.timestamp).toISOString().split('T')[0] === today;
                });
                
                if (alreadyCollected) {
                    return { success: false, message: 'You have already registered! Please come back tomorrow' };
                }
                
                // Add new attendance log
                const now = new Date();
                const logEntry = {
                    staffId: staff.staffId,
                    name: staff.name,
                    department: staff.department,
                    timestamp: now.toISOString()
                };
                
                logs.push(logEntry);
                localStorage.setItem('attendanceLogs', JSON.stringify(logs));
                
                // Update statistics
                this.updateStatistics(staff);
                
                return { 
                    success: true, 
                    message: 'Registration successful! Proceed to get your food',
                    staff: staff
                };
            },
            updateStatistics: function(staff) {
                const stats = JSON.parse(localStorage.getItem('statistics')) || {
                    dailyCount: 0,
                    weeklyCount: 0,
                    monthlyCount: 0,
                    lastScan: null
                };
                
                const today = new Date().toISOString().split('T')[0];
                
                // Check if we need to reset daily count
                if (stats.lastCountReset !== today) {
                    stats.dailyCount = 0;
                    stats.lastCountReset = today;
                }
                
                stats.dailyCount++;
                stats.weeklyCount++;
                stats.monthlyCount++;
                stats.lastScan = {
                    name: staff.name,
                    time: new Date().toISOString()
                };
                
                localStorage.setItem('statistics', JSON.stringify(stats));
                return stats;
            },
            getStatistics: function() {
                return JSON.parse(localStorage.getItem('statistics')) || {
                    dailyCount: 0,
                    weeklyCount: 0,
                    monthlyCount: 0,
                    lastScan: null
                };
            },
            resetDailyCount: function() {
                const stats = this.getStatistics();
                stats.dailyCount = 0;
                stats.lastCountReset = new Date().toISOString().split('T')[0];
                localStorage.setItem('statistics', JSON.stringify(stats));
                return stats;
            }
        };
        
        // Initialize database
        DB.init();
        
        // Helper functions
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString();
        }
        
        function formatTime(dateString) {
            const date = new Date(dateString);
            return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        }
        
        function showMessage(elementId, message, type) {
            const statusElement = document.getElementById(elementId);
            statusElement.textContent = message;
            statusElement.className = 'status-message ' + type;
            
            // Auto-hide after 5 seconds
            setTimeout(() => {
                statusElement.className = 'status-message';
                statusElement.textContent = '';
            }, 5000);
        }
        
        function simulateFingerprintScan(callback) {
            const icon = document.querySelector('.fingerprint-icon');
            icon.classList.add('scanning');
            
            setTimeout(() => {
                icon.classList.remove('scanning');
                
                // For demo, prompt for staff ID
                const staffId = prompt("Demo mode: Enter Staff ID to simulate fingerprint scan");
                
                if (staffId) {
                    callback(staffId);
                } else {
                    icon.classList.add('error');
                    setTimeout(() => icon.classList.remove('error'), 1000);
                }
            }, 1500);
        }
        
        // Fixed updateDashboardStats function to properly handle null lastScan
function updateDashboardStats() {
    const stats = DB.getStatistics();
    
    document.getElementById('meal-count').textContent = stats.dailyCount;
    document.getElementById('weekly-count').textContent = stats.weeklyCount;
    
    if (stats.lastScan) {
        document.getElementById('last-scan').textContent = stats.lastScan.name;
        document.getElementById('last-scan-time').textContent = formatTime(stats.lastScan.time);
    } else {
        // Properly reset the last scan display when lastScan is null
        document.getElementById('last-scan').textContent = '-';
        document.getElementById('last-scan-time').textContent = '-';
    }
}
        
        function updateClock() {
            const now = new Date();
            
            document.getElementById('current-time').textContent = now.toLocaleTimeString([], {
                hour: '2-digit',
                minute: '2-digit'
            });
            
            document.getElementById('current-date').textContent = now.toLocaleDateString([], {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
        
        function loadAttendanceTable(startDate = null, endDate = null) {
            const attendanceData = DB.getAttendance(startDate, endDate);
            const tableBody = document.getElementById('attendance-data');
            tableBody.innerHTML = '';
            
            if (attendanceData.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = '<td colspan="5" style="text-align: center;">No attendance records found</td>';
                tableBody.appendChild(row);
                return;
            }
            
            attendanceData.forEach(log => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${log.staffId}</td>
                    <td>${log.name}</td>
                    <td>${log.department}</td>
                    <td>${formatDate(log.timestamp)}</td>
                    <td>${formatTime(log.timestamp)}</td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        function loadStaffTable() {
            const staffData = DB.getStaff();
            const tableBody = document.getElementById('staff-data');
            tableBody.innerHTML = '';
            
            if (staffData.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = '<td colspan="4" style="text-align: center;">No staff records found</td>';
                tableBody.appendChild(row);
                return;
            }
            
            staffData.forEach(staff => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${staff.staffId}</td>
                    <td>${staff.name}</td>
                    <td>${staff.department}</td>
                    <td>${formatDate(staff.registrationDate)}</td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        function exportToCSV() {
            const startDate = document.getElementById('start-date').value;
            const endDate = document.getElementById('end-date').value;
            const attendanceData = DB.getAttendance(startDate, endDate);
            
            if (attendanceData.length === 0) {
                alert('No data to export');
                return;
            }
            
            let csvContent = 'data:text/csv;charset=utf-8,';
            csvContent += 'Staff ID,Name,Department,Date,Time\n';
            
            attendanceData.forEach(log => {
                const date = formatDate(log.timestamp);
                const time = formatTime(log.timestamp);
                csvContent += `${log.staffId},"${log.name}","${log.department}","${date}","${time}"\n`;
            });
            
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement('a');
            link.setAttribute('href', encodedUri);
            link.setAttribute('download', `attendance_report_${startDate}_to_${endDate}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
        // Tab navigation
        document.querySelectorAll('.tab-btn').forEach(button => {
            button.addEventListener('click', function() {
                const tabId = this.getAttribute('data-tab');
                
                // Update active button
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                this.classList.add('active');
                
                // Show active tab content
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                document.getElementById(tabId).classList.add('active');
                
                // Update dashboard if selected
                if (tabId === 'dashboard') {
                    updateDashboardStats();
                }
                
                // Update admin tables if selected and logged in
                if (tabId === 'admin' && document.getElementById('admin-dashboard').style.display === 'block') {
                    loadAttendanceTable();
                    loadStaffTable();
                }
            });
        });
        
        // Registration form submission
        document.getElementById('registration-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const name = document.getElementById('staff-name').value.trim();
            const staffId = document.getElementById('staff-id').value.trim();
            const department = document.getElementById('department').value.trim();
            
            // For demo purposes, we'll assume fingerprints are scanned
            const thumbPrint = 'thumb_' + staffId; // Simulated thumb print data
            const fingerPrint = 'finger_' + staffId; // Simulated finger print data
            
            if (!name || !staffId || !department) {
                showMessage('registration-status', 'Please fill all required fields', 'error');
                return;
            }
            
            const result = DB.addStaff({
                name: name,
                staffId: staffId,
                department: department,
                thumbPrint: thumbPrint,
                fingerPrint: fingerPrint
            });
            
            if (result.success) {
                showMessage('registration-status', 'Staff registered successfully', 'success');
                this.reset();
            } else {
                showMessage('registration-status', result.message, 'error');
            }
        });
        
        // Fingerprint scan for registration
        document.getElementById('scan-thumb').addEventListener('click', function() {
            const icon = document.querySelector('.fingerprint-icon');
            icon.classList.add('scanning');
            
            setTimeout(() => {
                icon.classList.remove('scanning');
                icon.classList.add('success');
                showMessage('registration-status', 'Thumb print scanned successfully', 'success');
                
                setTimeout(() => {
                    icon.classList.remove('success');
                }, 1000);
            }, 1500);
        });
        
        document.getElementById('scan-finger').addEventListener('click', function() {
            const icon = document.querySelector('.fingerprint-icon');
            icon.classList.add('scanning');
            
            setTimeout(() => {
                icon.classList.remove('scanning');
                icon.classList.add('success');
                showMessage('registration-status', 'Finger print scanned successfully', 'success');
                
                setTimeout(() => {
                    icon.classList.remove('success');
                }, 1000);
            }, 1500);
        });
        
        // Meal collection fingerprint scan
        document.getElementById('scan-meal').addEventListener('click', function() {
            const scanIcon = document.getElementById('scan-icon');
            scanIcon.classList.add('scanning');
            
            simulateFingerprintScan(staffId => {
                const result = DB.addAttendance(staffId);
                
                scanIcon.classList.remove('scanning');
                
                if (result.success) {
                    scanIcon.classList.add('success');
                    showMessage('scan-status', result.message, 'success');
                    updateDashboardStats();
                } else {
                    scanIcon.classList.add('error');
                    showMessage('scan-status', result.message, 'error');
                }
                
                setTimeout(() => {
                    scanIcon.classList.remove('success');
                    scanIcon.classList.remove('error');
                }, 1000);
            });
        });
        
        // Admin login
        document.getElementById('admin-login-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            // Simple admin authentication (for demo purposes)
            if (username === 'admin' && password === 'admin123') {
                document.getElementById('admin-login').style.display = 'none';
                document.getElementById('admin-dashboard').style.display = 'block';
                
                // Set today's date as default for filter
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('start-date').value = today;
                document.getElementById('end-date').value = today;
                
                loadAttendanceTable(today, today);
                loadStaffTable();
                
                showMessage('login-status', 'Login successful', 'success');
            } else {
                showMessage('login-status', 'Invalid username or password', 'error');
            }
        });
        
        // Admin logout
        document.getElementById('logout-btn').addEventListener('click', function() {
            document.getElementById('admin-login').style.display = 'block';
            document.getElementById('admin-dashboard').style.display = 'none';
            document.getElementById('admin-login-form').reset();
        });
        

    // Add this function to the DB object
DB.deleteTodayAttendance = function() {
    // Get all attendance logs
    let logs = JSON.parse(localStorage.getItem('attendanceLogs')) || [];
    const today = new Date().toISOString().split('T')[0];
    
    // Filter out today's records
    logs = logs.filter(log => {
        const logDate = new Date(log.timestamp).toISOString().split('T')[0];
        return logDate !== today;
    });
    
    // Save the filtered logs back to storage
    localStorage.setItem('attendanceLogs', JSON.stringify(logs));
    
    // Reset today's count, weekly total, and last collection
    const stats = this.getStatistics();
    stats.dailyCount = 0;
    stats.weeklyCount = 0;  // Reset weekly total
    stats.lastScan = null;  // Reset last collection
    stats.lastCountReset = new Date().toISOString().split('T')[0];
    localStorage.setItem('statistics', JSON.stringify(stats));
    
    return stats;
};


// Add this function to process attendance data for the chart
function prepareChartData(days = 7) {
    const attendanceLogs = JSON.parse(localStorage.getItem('attendanceLogs')) || [];
    const chartData = [];
    
    // Get date range (last X days)
    const endDate = new Date();
    const startDate = new Date();
    startDate.setDate(startDate.getDate() - days);
    
    // Create array of all dates in range
    const dateArray = [];
    const currentDate = new Date(startDate);
    while (currentDate <= endDate) {
        dateArray.push(new Date(currentDate));
        currentDate.setDate(currentDate.getDate() + 1);
    }
    
    // Count meals for each date
    dateArray.forEach(date => {
        const dateStr = date.toISOString().split('T')[0];
        const count = attendanceLogs.filter(log => {
            const logDate = new Date(log.timestamp).toISOString().split('T')[0];
            return logDate === dateStr;
        }).length;
        
        chartData.push({
            date: dateStr,
            count: count
        });
    });
    
    return chartData;
}

// Function to render the chart
function renderMealChart() {
    const chartData = prepareChartData();
    
    Highcharts.chart('meal-chart-container', {
        chart: {
            type: 'line',
            style: {
                fontFamily: 'Poppins, sans-serif'
            },
            backgroundColor: 'rgba(255, 255, 255, 0.8)'
        },
        title: {
            text: 'Daily Meal Count Trends',
            style: {
                color: '#5e60ce',
                fontWeight: '600'
            }
        },
        xAxis: {
            categories: chartData.map(item => item.date),
            labels: {
                rotation: -45,
                style: {
                    fontSize: '12px'
                }
            },
            title: {
                text: 'Date'
            }
        },
        yAxis: {
            title: {
                text: 'Number of Meals'
            },
            min: 0
        },
        tooltip: {
            headerFormat: '<span style="font-size:10px">{point.key}</span><table>',
            pointFormat: '<tr><td style="color:{series.color};padding:0">{series.name}: </td>' +
                         '<td style="padding:0"><b>{point.y}</b></td></tr>',
            footerFormat: '</table>',
            shared: true,
            useHTML: true
        },
        plotOptions: {
            line: {
                dataLabels: {
                    enabled: true
                },
                enableMouseTracking: true,
                color: '#5e60ce'
            }
        },
        series: [{
            name: 'Meals',
            data: chartData.map(item => item.count),
            marker: {
                radius: 5
            }
        }],
        credits: {
            enabled: false
        },
        responsive: {
            rules: [{
                condition: {
                    maxWidth: 500
                },
                chartOptions: {
                    legend: {
                        layout: 'horizontal',
                        align: 'center',
                        verticalAlign: 'bottom'
                    }
                }
            }]
        }
    });
}

// Function to update the chart when new data is available
function updateMealChart() {
    renderMealChart();
}

// Add function to update the chart to the DB object (add this to your existing DB object)
DB.updateChart = function() {
    if (document.getElementById('meal-chart-container')) {
        updateMealChart();
    }
};

// Modify existing addAttendance function to update chart (add this at the end of the function)
const originalAddAttendance = DB.addAttendance;
DB.addAttendance = function(staffId) {
    const result = originalAddAttendance.call(this, staffId);
    this.updateChart();
    return result;
};

// Add this to the end of deleteTodayAttendance function
const originalDeleteTodayAttendance = DB.deleteTodayAttendance;
DB.deleteTodayAttendance = function() {
    const result = originalDeleteTodayAttendance.call(this);
    this.updateChart();
    return result;
};

// Add code to initialize and update chart when tab is clicked
document.addEventListener('DOMContentLoaded', function() {
    // Add Highcharts library to the page
    const script = document.createElement('script');
    script.src = 'https://cdnjs.cloudflare.com/ajax/libs/highcharts/10.3.3/highcharts.min.js';
    document.head.appendChild(script);
    
    script.onload = function() {
        // Update admin tab click handler to also render chart
        document.querySelectorAll('.tab-btn').forEach(button => {
            const originalClickHandler = button.onclick;
            button.onclick = function() {
                if (this.getAttribute('data-tab') === 'admin' && 
                    document.getElementById('admin-dashboard').style.display === 'block') {
                    setTimeout(renderMealChart, 100); // Allow time for container to be visible
                }
                if (originalClickHandler) originalClickHandler.call(this);
            };
        });
        
        // Update the chart when filter button is clicked
        const filterBtn = document.getElementById('filter-btn');
        const originalFilterClick = filterBtn.onclick;
        filterBtn.onclick = function() {
            if (originalFilterClick) originalFilterClick.call(this);
            renderMealChart();
        };
    };
});

// Replace the reset-count event listener with this
document.getElementById('reset-count').addEventListener('click', function() {
    if (confirm('Are you sure you want to reset all counters? Daily count, weekly total, and last collection will be cleared, and all of today\'s records will be deleted.')) {
        // Delete today's attendance and reset all counters
        DB.deleteTodayAttendance();
        
        // Update the dashboard stats
        updateDashboardStats();
        
        // Show success message
        showMessage('login-status', 'All counters reset and today\'s records deleted successfully', 'success');
        
        // Reload the attendance table with current filter settings
        const startDate = document.getElementById('start-date').value;
        const endDate = document.getElementById('end-date').value;
        loadAttendanceTable(startDate, endDate);
    }
});
        
        // Filter attendance by date
        document.getElementById('filter-btn').addEventListener('click', function() {
            const startDate = document.getElementById('start-date').value;
            const endDate = document.getElementById('end-date').value;
            
            if (!startDate || !endDate) {
                alert('Please select both start and end dates');
                return;
            }
            
            loadAttendanceTable(startDate, endDate);
        });
        
        // Export attendance to CSV
        document.getElementById('export-btn').addEventListener('click', exportToCSV);
        
        // Initialize clock
        updateClock();
        setInterval(updateClock, 60000);
        
        // Load initial dashboard stats
        updateDashboardStats();

      // Add search and filter UI to the Admin dashboard
function addStaffSearchUI() {
    // Create the search and filter container
    const searchFilterContainer = document.createElement('div');
    searchFilterContainer.className = 'search-filter-container';
    searchFilterContainer.innerHTML = `
        <div class="search-bar">
            <input type="text" id="staff-search" class="form-control" placeholder="Search staff by name or ID...">
            <button id="search-btn" class="btn btn-primary">
                <i class="fas fa-search"></i> Search
            </button>
        </div>
        <div class="filter-options">
            <div class="form-group">
                <label for="department-filter">Department</label>
                <select id="department-filter" class="form-control">
                    <option value="">All Departments</option>
                </select>
            </div>
            <div class="form-group">
                <label for="registration-date-filter">Registration Date</label>
                <select id="registration-date-filter" class="form-control">
                    <option value="">All Time</option>
                    <option value="7">Last 7 Days</option>
                    <option value="30">Last 30 Days</option>
                    <option value="90">Last 3 Months</option>
                    <option value="365">Last Year</option>
                </select>
            </div>
            <div class="form-group">
                <label for="sort-by">Sort By</label>
                <select id="sort-by" class="form-control">
                    <option value="name-asc">Name (A-Z)</option>
                    <option value="name-desc">Name (Z-A)</option>
                    <option value="id-asc">Staff ID (Ascending)</option>
                    <option value="id-desc">Staff ID (Descending)</option>
                    <option value="department-asc">Department (A-Z)</option>
                    <option value="department-desc">Department (Z-A)</option>
                    <option value="date-asc">Registration Date (Oldest First)</option>
                    <option value="date-desc">Registration Date (Newest First)</option>
                </select>
            </div>
            <button id="apply-filters" class="btn btn-primary">
                <i class="fas fa-filter"></i> Apply Filters
            </button>
            <button id="reset-filters" class="btn btn-danger">
                <i class="fas fa-times"></i> Reset
            </button>
        </div>
    `;

    // Insert the search filter container before the staff list
    const staffListSection = document.querySelector('.staff-list');
    staffListSection.parentNode.insertBefore(searchFilterContainer, staffListSection);

    // Add styles for search and filter UI
    const style = document.createElement('style');
    style.textContent = `
        .search-filter-container {
            background: var(--white);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }
        
        .search-bar {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .search-bar input {
            flex: 1;
        }
        
        .filter-options {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: flex-end;
        }
        
        .filter-options .form-group {
            flex: 1;
            min-width: 180px;
        }
        
        .filter-options button {
            height: 46px;
        }
        
        .delete-staff-btn {
            padding: 6px 12px;
            font-size: 14px;
            transition: all 0.2s ease;
        }
        
        .delete-staff-btn:hover {
            background: linear-gradient(135deg, #ff4d6d, #c9184a);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(239, 71, 111, 0.3);
        }
        
        @media (max-width: 768px) {
            .search-bar, .filter-options {
                flex-direction: column;
            }
            
            .filter-options .form-group {
                width: 100%;
            }
            
            .search-bar input, .filter-options button {
                width: 100%;
            }
        }
    `;
    document.head.appendChild(style);

    // Populate departments filter from existing staff data
    populateDepartmentsFilter();
}

// Populate the departments dropdown with unique department values
function populateDepartmentsFilter() {
    const departmentSelect = document.getElementById('department-filter');
    if (!departmentSelect) return;

    const staffData = DB.getStaff();
    const departments = new Set();

    staffData.forEach(staff => {
        if (staff.department) {
            departments.add(staff.department);
        }
    });

    // Clear existing options except the first one
    while (departmentSelect.options.length > 1) {
        departmentSelect.remove(1);
    }

    // Add department options
    departments.forEach(department => {
        const option = document.createElement('option');
        option.value = department;
        option.textContent = department;
        departmentSelect.appendChild(option);
    });
}

// Add this function to the DB object
DB.deleteStaff = function(staffId) {
    // Get all staff records
    let staffRecords = JSON.parse(localStorage.getItem('staffRecords')) || [];
    
    // Find the staff to delete
    const staffToDelete = staffRecords.find(staff => staff.staffId === staffId);
    
    if (!staffToDelete) {
        return { success: false, message: 'Staff not found' };
    }
    
    // Filter out the staff with the given ID
    staffRecords = staffRecords.filter(staff => staff.staffId !== staffId);
    
    // Save the filtered staff records back to storage
    localStorage.setItem('staffRecords', JSON.stringify(staffRecords));
    
    return { 
        success: true, 
        message: 'Staff deleted successfully',
        deletedStaff: staffToDelete
    };
};

// Enhance DB object with search and filter capabilities
DB.searchAndFilterStaff = function(searchTerm, filters, sortOption) {
    let staffData = this.getStaff();
    const today = new Date();
    
    // Apply search term
    if (searchTerm) {
        const searchLower = searchTerm.toLowerCase();
        staffData = staffData.filter(staff => 
            staff.name.toLowerCase().includes(searchLower) || 
            staff.staffId.toLowerCase().includes(searchLower)
        );
    }
    
    // Apply department filter
    if (filters.department) {
        staffData = staffData.filter(staff => staff.department === filters.department);
    }
    
    // Apply registration date filter
    if (filters.registrationDays) {
        const cutoffDate = new Date();
        cutoffDate.setDate(today.getDate() - filters.registrationDays);
        
        staffData = staffData.filter(staff => {
            const regDate = new Date(staff.registrationDate);
            return regDate >= cutoffDate;
        });
    }
    
    // Apply sorting
    if (sortOption) {
        staffData.sort((a, b) => {
            switch(sortOption) {
                case 'name-asc':
                    return a.name.localeCompare(b.name);
                case 'name-desc':
                    return b.name.localeCompare(a.name);
                case 'id-asc':
                    return a.staffId.localeCompare(b.staffId);
                case 'id-desc':
                    return b.staffId.localeCompare(a.staffId);
                case 'department-asc':
                    return (a.department || '').localeCompare(b.department || '');
                case 'department-desc':
                    return (b.department || '').localeCompare(a.department || '');
                case 'date-asc':
                    return new Date(a.registrationDate) - new Date(b.registrationDate);
                case 'date-desc':
                    return new Date(b.registrationDate) - new Date(a.registrationDate);
                default:
                    return 0;
            }
        });
    }
    
    return staffData;
};

// Consolidated loadStaffTable function that supports both basic loading and search/filter
function loadStaffTable(searchTerm = '', filters = {}, sortOption = 'name-asc') {
    // Use the search and filter function to get data
    const staffData = DB.searchAndFilterStaff(searchTerm, filters, sortOption);
    const tableBody = document.getElementById('staff-data');
    
    if (!tableBody) return; // Safety check
    
    tableBody.innerHTML = '';
    
    if (staffData.length === 0) {
        const row = document.createElement('tr');
        row.innerHTML = '<td colspan="5" style="text-align: center;">No staff records found</td>';
        tableBody.appendChild(row);
        return;
    }
    
    // Update the table headers to include an Action column
    const staffTable = document.getElementById('staff-table');
    const headerRow = staffTable.querySelector('thead tr');
    
    // Check if Action column already exists
    if (!headerRow.querySelector('th:nth-child(5)')) {
        const actionHeader = document.createElement('th');
        actionHeader.textContent = 'Action';
        headerRow.appendChild(actionHeader);
    }
    
    staffData.forEach(staff => {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${staff.staffId}</td>
            <td>${staff.name}</td>
            <td>${staff.department || ''}</td>
            <td>${formatDate(staff.registrationDate)}</td>
            <td>
                <button class="btn btn-danger delete-staff-btn" data-staff-id="${staff.staffId}" 
                style="padding: 6px 12px; font-size: 14px;">
                    <i class="fas fa-trash-alt"></i> Delete
                </button>
            </td>
        `;
        tableBody.appendChild(row);
    });
    
    // Add event listeners to delete buttons
    document.querySelectorAll('.delete-staff-btn').forEach(button => {
        button.addEventListener('click', function() {
            const staffId = this.getAttribute('data-staff-id');
            const staff = staffData.find(s => s.staffId === staffId);
            
            if (confirm(`Are you sure you want to delete ${staff.name} (Staff ID: ${staffId})? This action cannot be undone.`)) {
                const result = DB.deleteStaff(staffId);
                
                if (result.success) {
                    showMessage('login-status', result.message, 'success');
                    
                    // Reload the staff table with current search/filter settings
                    const searchTerm = document.getElementById('staff-search')?.value || '';
                    const departmentFilter = document.getElementById('department-filter')?.value || '';
                    const registrationDateFilter = document.getElementById('registration-date-filter')?.value || '';
                    const sortBy = document.getElementById('sort-by')?.value || 'name-asc';
                    
                    loadStaffTable(searchTerm, {
                        department: departmentFilter,
                        registrationDays: registrationDateFilter ? parseInt(registrationDateFilter) : null
                    }, sortBy);
                    
                    // Update the departments filter as it might have changed
                    populateDepartmentsFilter();
                    
                    // Also reload the attendance table as it might contain references to the deleted staff
                    const startDate = document.getElementById('start-date')?.value || '';
                    const endDate = document.getElementById('end-date')?.value || '';
                    if (typeof loadAttendanceTable === 'function') {
                        loadAttendanceTable(startDate, endDate);
                    }
                } else {
                    showMessage('login-status', result.message, 'error');
                }
            }
        });
    });
}

// Apply search term and filters to the staff table
function applySearchAndFilters() {
    const searchTerm = document.getElementById('staff-search')?.value || '';
    const departmentFilter = document.getElementById('department-filter')?.value || '';
    const registrationDateFilter = document.getElementById('registration-date-filter')?.value || '';
    const sortBy = document.getElementById('sort-by')?.value || 'name-asc';
    
    loadStaffTable(searchTerm, {
        department: departmentFilter,
        registrationDays: registrationDateFilter ? parseInt(registrationDateFilter) : null
    }, sortBy);
}

// Initialize event listeners for search and filter controls
function initSearchFilterListeners() {
    // Search button click
    document.getElementById('search-btn')?.addEventListener('click', applySearchAndFilters);
    
    // Enter key in search box
    document.getElementById('staff-search')?.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            applySearchAndFilters();
        }
    });
    
    // Apply filters button
    document.getElementById('apply-filters')?.addEventListener('click', applySearchAndFilters);
    
    // Reset filters button
    document.getElementById('reset-filters')?.addEventListener('click', function() {
        const searchEl = document.getElementById('staff-search');
        const departmentEl = document.getElementById('department-filter');
        const registrationDateEl = document.getElementById('registration-date-filter');
        const sortByEl = document.getElementById('sort-by');
        
        if (searchEl) searchEl.value = '';
        if (departmentEl) departmentEl.value = '';
        if (registrationDateEl) registrationDateEl.value = '';
        if (sortByEl) sortByEl.value = 'name-asc';
        
        applySearchAndFilters();
    });
}

// Initialize the search and filter functionality
document.addEventListener('DOMContentLoaded', function() {
    // Wait for the admin tab to be fully loaded
    const adminTabBtn = Array.from(document.querySelectorAll('.tab-btn')).find(btn => 
        btn.getAttribute('data-tab') === 'admin'
    );
    
    if (adminTabBtn) {
        const originalClickHandler = adminTabBtn.onclick;
        adminTabBtn.onclick = function() {
            setTimeout(() => {
                if (document.getElementById('admin-dashboard') && 
                    document.getElementById('admin-dashboard').style.display === 'block') {
                    // Check if search UI is already added
                    if (!document.querySelector('.search-filter-container')) {
                        addStaffSearchUI();
                        initSearchFilterListeners();
                    }
                    // Always load the staff table with default parameters
                    loadStaffTable();
                }
            }, 200);
            if (originalClickHandler) originalClickHandler.call(this);
        };
    }
    
    // Also initialize when page loads if admin tab is already active
    setTimeout(() => {
        if (document.getElementById('admin-dashboard') && 
            document.getElementById('admin-dashboard').style.display === 'block') {
            if (!document.querySelector('.search-filter-container')) {
                addStaffSearchUI();
                initSearchFilterListeners();
            }
            // Always load the staff table with default parameters
            loadStaffTable();
        }
    }, 500);
});


    </script>
    
</body>
</html>